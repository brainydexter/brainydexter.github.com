<html>
<head>
<title> Priyank Jain </title>
<link rel=styleSheet href="style.css" type="text/css">
<meta name="keywords" content="Priyank Jain, fly2priyank, UNCC, charlotte, game developer, game, developer, brainydexter, entropologygames, entropology games, words, wordsAway, words Away, word games" />
<meta name="description" content="Priyank Jain's portfolio." />
</head>
<body>

<table border=6 cellspacing=10 width=800 align="center">
  <tr>
      <td>
      <a href="../index.html"><img src="../images/title.jpg" width=100% height=200 border=5 class="imageLink"></a>

      </td>
  </tr>

  <tr>
      <td>
      <hr>
      <table width=100%>
             <tr>
<td align="center" width=15%>
                 <a href="../index.html" target="_parent" class="pageLink">About Me</a>

                 </td>
                 <td align="center" width=15%>
                 <a href="../projects.html" target="_parent" class="pageLink">Projects</a>
                 </td>
                 <td align="center" width=25%>
                 <a href="../snippets.html" target="_parent" class="pageLink">Code Snippets</a>
                 </td>
                 <td align="center" width=15%>

                 <a href="../resume.html" target="_parent" class="pageLink">Resume</a>
                 </td>
                 <td align="center" width=25%>
                 <a href="../contact.html" target="_parent" class="pageLink">Contact Me</a>
                 </td>
             </tr>
      </table>
      <hr>

      </td>
  </tr>
  
  <tr>
  <td>

	<table border=0 width=100% class="bodytext" align="center" height=300 cellpadding="10">
		       <tr>
			
				<th  align="center" >
		       <p class="header"> Words-Away <a name="Top"></a></p>
			   </th>
			   </tr>
				
				<tr>
				<td  align="center" >

					<iframe src="https://player.vimeo.com/video/177944675" width="225" height="400" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen>
					</iframe>
					<p><a href="https://vimeo.com/177944675">wordsAway Gameplay</a> from <a href="https://vimeo.com/user3539182">Priyank jain</a></p>
				</td>
				
				</tr>
				<!-- <tr>
					<td align="center"> 
					<a class="projDesc" href="http://cid-35f6b81eda3cacb3.skydrive.live.com/self.aspx/Portfolio%20Projects/Kolor/Kolor%20exec.zip" rel="me" target="_blank" >Play Game</a>  &nbsp | &nbsp
				<a class="projDesc" href="http://cid-35f6b81eda3cacb3.skydrive.live.com/self.aspx/Portfolio%20Projects/Kolor/Kolor%20Src.zip" rel="me"  target="_blank" >Source Code </a> 
					</td>
				</tr> -->
				
				<tr>
				<td>
				
				<p>

WordsAway is a game I developed using Unity/C# in 2.5 months with me being the only engineer on the team. The game offers multiple levels each of which offers a challenge in its own right. The core game mechanic is to form words by connecting adjacent letters and formed words are then cleared from the board. Player wins the game by clearing the set challenge or is defeated if the letters tower up and reach the ceiling.
				</p>

				<p>
I did an initial prototype using ThreeJs to visualize if the game concept would be fun or not. The game was not visually great, but the core game seemed promising and the feedback further encouraged me to develop it into a complete game. Prototyping exposed some big issues that I was well prepared to tackle while developing the game in C#. I wanted to use this game to be a part of my portfolio, but I also wanted to build something that was polished that I could be proud of, show to people and also sell in the market.
			</p>
			
			<hr>
			
			<p>
			This is a list of things I worked on during the dev cycle:
			<ul>
			    <li>
			        <a href="https://github.com/brainydexter/PublicCode/blob/master/common/EventAggregator.cs">Event aggregator for decoupling publishers and event subscribers</a>
			        <ul>
			            <li>avoid module dependencies</li>
			            <li>compile time issues with generics</li>
			            <li>processing all subscribers at once</li>
			        </ul>
			    </li>
			    <li> Infrastructure to support multiple boards
			    	<ul>
			    		<li> Generic interface which specifc boards can implement </li>
			    		<li> Board can register for whatever event they are interested in</li>
			    		<li> Board is responsible for publishing board over event populated with whatever relevant details</li>
			    	</ul>
			    </li>
			    <li> Rubber-Banding: Helping players to catch up against the towering blocks (using weighted probabiblity in random)</li>
			    <li>Swipe to submit</li>
			    <ul>
			        <li>Active word manager for managing&nbsp;letters while word is being formed</li>
			        <li>originally implemented tap to submit and transitioned to swipe based on user feedback</li>
			        <li>Tuning the drag threshold</li>
			    </ul>
			    <li>
			        Menu navigation by dynamically managing unity scenes
			        <ul>
			            <li>Replaying&nbsp;game through menu system results in no memory leaks</li>
			            <li>using coroutines for menu change</li>
			            <li>designers could independently design screens</li>
			        </ul>
			    </li>
			    <li>Object pooling and allocating resources&nbsp;at game start to avoid repeated allocation at runtime</li>
			    <li>
			        Powerups
			        <ul>
			            <li>cyclic conveyor belt effect for alongwith object pooling</li>
			            <li>coroutines to handle&nbsp;powerup effect</li>
			            <li>Drag&amp;Drop behavior at runtime</li>
			            <li>Rocket has an oscillating behavior with tuning parameters of amplitude/speed</li>
			        </ul>
			    </li>
			    <li>
			    	Component Managers
			    	<ul>
			    		<li>Implementing generic audio, powerup, animation unity components&nbsp;which enabled the designers to associate the FX to event type</li>
			    		<li>Animation managers support generic gameobject prefabs which are expected to get disabled at the end of their lifecycle </li>
			    	</ul>
			    
			    </li>
			    <li>
			        <a href="https://github.com/brainydexter/PublicCode/blob/master/common/TrieNode.cs">Optimized Trie for O(1) lookup of words</a>
			        <ul>
			            <li>stats</li>
			            <li>wrote utility with knobs to prune english dictionary : 3 - 7 letter words</li>
			        </ul>
			    </li>
			    <li>
			        Gameplay<br />
			        <ul>
			            <li>Sharing 1 material across all blocks to avoid extra draw calls</li>
			            <li>Sharing 1 material across all powerups&nbsp;to avoid extra draw calls</li>
			            <li>Managing falling block, board with generic methods, powerups</li>
			            <li>Letter block selection state</li>
			            <li>setup scoring for words</li>
			        </ul>
			    </li>
			    <li>unity meta hell</li>
			    <li>
			        Automating build for android
			        <ul>
			            <li>commandline build for android</li>
			            <li>upload to google drive</li>
			            <li>easy to distribute to testers</li>
			        </ul>
			    </li>
			</ul>
			<hr>
			</p>
			
<!-- <p>
 <a name="EventAggregator" class="question">EventAggregator </a>
<br>
<ul>
	<li> <a href="#Decoupling"> Decoupling - avoid module dependencies </a> </li>
</ul>
	Event aggregator details go in here
</p> -->

<!--
<p>
	<a name="Decoupling" class="subQuestion">  Decoupling - avoid module dependencies </a>
	<br>
Decoupling - avoid module dependencies - details go here.
Take a look at:
 <ul>
 	<li> EventAggregator.cs </li>
 </ul>
 
 Due to the extensive nature of the collada format that it can represent, I only implemented the subset that is required by the game. Uptil now, it supports the following:
<ul>
 <li> Scene Graph </li>
 <li> Model Mesh information (organised in a tree structure) stored by process the Geometry Node </li>
 <li> Node in scenegraph can have the following operations defined in DAE (VSGNode.h and VSGNode.cpp):
	<ul>
	<li> Lookat </li>
	<li> Transformation defined by a 4x4 matrix </li>
	<li> Translate along X / Y or Z axis </li>
	<li> Rotation at a given angle about an arbitrary axis </li>
	<li> Scale </li>
	<li> Skew </li>
	</ul>
</li>
 <li> Geometry associated can in-turn be made up of many different type of primitives. My importer supports:
	<ul>
	<li> Triangle List </li>
	<li> Polygon List </li>
	</ul>
</li>
 <li> At the heart of the model, resides the vertex (Vertex.h and Vertex.cpp) which stores data attributes as a boost::hash_map { Semantic, (float*) } </li>
</ul>
The facade with which the DAE Model is accessed is VSceneGraph.h and VSceneGraph.cpp wrapped around in Collada.h
</p>

<p>
	<a name="RenderModel" class="subQuestion"> Rendering the Model </a>
	<br>
	Originally, I was using glBegin and glEnd to render the model. However, when I loaded in a model with higher poly count, the framerate crippled. After researching, I resorted to using Indexed Vertex Buffer Objects. For generating the indices for vertices, I run the list of vertices through a hash-map and assign a unique index for each vertex. This can be seen in the following code:
	-- GeomMesh.cpp constructor and bool VertexExists(...)
	
	<br><br>
	This smoothened out the model rendering FPS rate! These are some of the links I used to help me understand about VBOs:
	- (insert bookmarks)
</p>
	<a href="#Top"> Top </a>
<hr>

<p>
<a name="MoveWorld" class="question">
 How do I move in this world ?
</a>
<br>
	Once the model was rendered, I wanted to create a "player" who could move around in the world. I invited a ton of sub-problems for me with this! To begin with, I needed a mechanism to keep track of the player's position and orientation. This gave birth to FrameTransform. I used openGL superbible as my reference which made me use three vectors:
	<ul>
	
	<li> Origin </li>
	<li> Up </li>
	<li> Forward vector </li>
	
	</ul>
	
	Using right hand thumb rule, I wrote functions that would let the entity move or rotate in the world. The details can be found in FrameTransform.h and .cpp. This was a great learning experience since I was not using any of the glTranslate/ glRotate functions anymore and instead, i was multiplying the transformation matrix on the opengl stack manually!
	<br><br>
	
	When I got the frame Transformation working correctly, I had a player moving around and rotating in world along all the three dimensions. This essentially meant that the player could fly anywhere. Clearly, this is not what I wanted. PlayerTransform Enters. An inherited class of FrameTransform, I restrict the players movement only along the X/Z axis. For the given methods, I had to make a couple of tweaks:
	- Move (..)
	- Rotate(...)
	<br><br>
	After this, I had a player model moving around.
	</p>
	<a href="#Top"> Top </a>
<hr>

	<p>
<a name="Camera" class="question"> How do I make that First-Person View now ? (my own gluLookAt) </a>
<br> <br>
 I had a way to move the player around, but I wanted to get the First-person view! Essentially what this meant was, I needed to position world and everything else relative to player's coordinate system. So, one way was to move the world when player moves, giving the illusion that the player moves. Or, use the OpenGL transformation stack to transform everything as per player's Coordinate system. I chose the second approach and this is exactly what my Camera class does. It is a 'friend' of (Human)Player, since the camera is tightly coupled to the player. This is the documentation I wrote for the camera:
 
<pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee;font-size: 12px;border: 1px dashed #999999;line-height: 14px;padding: 5px; overflow: auto; width: 100%"><code> class FrameTransform (6 DOF)
-    glm::vec3 m_Origin;
-    glm::vec3 m_Forward;
-    glm::vec3 m_Up;
&#8226;    MoveForward/Right/Up ( amt )
&#8226;    RotateAround X/Y/Z ( amt )
&#8226;    void ApplyActorTransform () =&gt; calls glMultMatrix(..)

class Player : public GameObject 
-    FrameTransform m_Transform; =&gt; Coordinate system w.r.t the world CS

class World : public GameObject (level class)
-    FrameTransform m_Transform; =&gt; Coordinate system w.r.t the world CS
</code></pre>

<br>
A first person camera helps to view the world from the players eyes. Thus, we need a transformation which enables the view from players reference. <br>
Example:
<ul>
<li> WCS (0, 0)W  </li>
<li> PCS (2, 2)W => Player is at 2, 2 in the world coordinate system => PW<-P (2, 2)  </li>
<li> Chair P = (.5, .5)P  </li>
<li> => Chair W = PW<-P * ChairP = (2.5, 2.5)W </li>
</ul>
This way we can get everything in Worlds frame of reference. For First Person Camera, we need to transform everything as per Players transformation, i.e. everything needs to be brought into Players coordinate system.
<br><br>

Player.m_Transform represents PW<-P . If we invert this matrix, we get PP<-W which brings everything from World coordinate space to Player Coordinate space (and we then see everything from Players perspective).
<br><br>
This way, everything is still specified in the WCS (given the Push/PopMatrix() style) and transformed to the Players view.
<br><br>
<a class="subQuestion"> Implementation </a>
<br>
<pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee;font-size: 12px;border: 1px dashed #999999;line-height: 14px;padding: 5px; overflow: auto; width: 100%"><code>void Camera :: ApplyCameraTransform()
{
    glm::mat4 l_TransformationMatrix;
    m_Player-&gt;m_Transformation.GetTransformation(l_TransformationMatrix, false); //false, since we want the Translation otherwise only rotation is returned

    l_TransformationMatrix = glm::core::function::matrix::inverse(l_TransformationMatrix);
    glMultMatrixf(glm::value_ptr(l_TransformationMatrix));
}
</code></pre>
<br><br>
Camera is assumed to be a friend class of Player and thus has access to protected member m_Player->m_Transformation. 
GetTransformation(..) populates l_TransformationMatrix with translation and rotation information of the player. This represents PW<-P at the moment. If we invert it, we get PP<-W.
<br><br>
We then multiply on the matrix stack, this P to bring following transformation in Players Coordinate System. It is invoked as follows:
<br>
<pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee;font-size: 12px;border: 1px dashed #999999;line-height: 14px;padding: 5px; overflow: auto; width: 100%"><code>
void GameGL :: paintGL()
{
    glClear(GL_COLOR_BUFFER_BIT &#124; GL_DEPTH_BUFFER_BIT);
    
    glPushMatrix();
        mp_Camera-&gt;ApplyCameraTransform();

        std::list&lt;GameObject*&gt;::iterator it_GameObjs;

            for(it_GameObjs = m_GameObjectList.begin(); it_GameObjs != m_GameObjectList.end(); it_GameObjs++) {
                (*it_GameObjs)-&gt;Render();
            }
... 
}
</code></pre>
<br><br>
As I read more about openGL, I came across the gluLookAt function which in essence, does the same thing as I have done.
 </p>
 <a href="#Top"> Top </a>
<hr>

<p>
<a name="Input" class="question">
Separating Input into an entity in itself
</a>
<br><br>
Uptil now, I did not have an entity which would take care of all the input handling in one place. Also, Qt is a GUI framework and is not really designed for games. Thus, I needed a way to keep track of what keys are pressed and what buttons are clicked. For this requirement, I had to make Input class a wrapper to process all the incoming events.
<br><br>
To handle key-pressed event, I decided to use a QSet. Whenever a key was pressed, I add the 'Key' to this set. Whenever the key is released, I remove the key from set. Querying if a key is currently pressed is found by querying the set.
<br><br>
To handle mouse click events, I use a hash { Mouse_Button, bool }. As a button is pressed/released, I update the hash[button] to TRUE/FALSE. When a button is queried, it is a simple lookup in the hash. Also, if the button is found to be pressed (or TRUE), I invoke the release on that button, in order to fix the problem of reporting false button clicks.
<br><br>
Once I had this in order, the input classes worked like a charm.
</p>
<a href="#Top"> Top </a>
<hr>

<p>
<a name="Collision" class="question">
 When player and bullet collide ?
 </a> 
 <br><br>
	At this point, I had the player strafing and turning in-sync with the keyboard and mouse input. Also, players were firing bullets with a left mouse button click. Now, I needed to focus on the core of game mechanic, i.e., hitting/coloring other players by a bullet. This called for collision detection!
<br><br>	
	My experience with the prototype taught me that I would need some sort of broad-phase collision detection, since a O(n^2) operation was killing the framerate even with a meager number of players on the field firing bullets at each other. Thus, after some thought, I came up with this approach:
	<br><br>
	The involved actors are :-
<ul>
<li> Players </li>
<li> Bullets(Fired) </li>
<li> Weapons (placed at points located throughout the level, which other players can pick up, aka static objects) </li>
<li> World </li>
</ul>
As of now, I am just trying to get the Players and bullet collision pairs.
<ul>
<li>
Players: Players are represented by a bounding sphere, located at a position and moving with a velocity. Each player would have approximately the bounding sphere of same size. They can potentially collide with:<br> 
Players - weapons <br>
Players - World <br>
</li>

<li>
Bullets: Bullets are  represented by a segment with a start point and an end point (using posn, posn + vel) (each frame). Bullet can hit :-
<table border=1 align="center" cellpadding="5" class="bodyText">
<tr>
<td>
Fired<br> Bullet
</td>
	
<td>
Player <br> <hr>
(Other) Bullet <br> <hr>
World 
</td>
</tr>
</table>
</li>
</ul>
<br>
Approach:
<br><br>
As each player and bullet is created, associate a reference to each entity within CollisionMgr as a list<Player*> and list<Bullet*>.
<br><br>
On each update frame, do the following:
<br>
<ul>
<li>
For each player, find Cell(s); it is associated with :=> list< Cell* > PlayerCells
</li>

<li>
For each Bullet (segment), find Cell(s); it is associated with :=> list< Cell* > BulletCells
</li>

<li>
For each entity, the cell(s) can be found out based on the entity.
<ul>
<li> Player: Bounding sphere :The grid size are uniformly sized cell (size, M) such that the M = 2R (R = radius of the bounding sphere). Thus, at any given time, at most the bounding sphere can be in contact with 4 cells. To determine the cells associated, find the 8 points for a given sphere (each at 45 degrees to the X,Y,Z axis along the 8 octants). (And then find out, in which grid cell does each of the point lie. This could at max return 4 cells).</li>

<li>Bullet: Segmented Ray with endpoints at : Posn and (Posn + vel). Thus, all the cells that the line passes through would yield the cells. </li>
</ul>
</li>

<li>
Cell can be a structure like

<pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee;font-size: 12px;border: 1px dashed #999999;line-height: 14px;padding: 5px; overflow: auto; width: 100%"><code>Cell {

List &lt; Player*&gt;

List &lt; Bullet* &gt;

Value (x,y,z) =&gt; unique value based on these three coordinates

}
</code></pre>
</li>

<li> As a cell is found by either of the entities, given its coordinates and grid position, a cell can be put on the hash-map. As the players and bullets yield cells, they can be referenced using this map and in-turn populate the list of player and bullet residing within that cell structure.
</li>
</ul>

After all the player and bulletaffected cells have been found, if we iterate through the hash-map, then it would yield all the possible pair of colliding players and bullets in a given cell. This can then be further handled using narrow-phase collision.
	<br><br>
Once the broad-phase collision detection is working, narrow phase would be a Bounding-Sphere / Segment (Player/Bullet) collision check.  This required me to compute the bounding sphere for the given DAE model. I wrote a simple method to compute the bounding sphere:
<ul>
 <li> Iterate through all the points on the model </li>
 <li> Keep a track of the minimum and the maximum point found so far </li>
 <li> Sphere radius = distance(minimumPt, maximumPt) * 0.5; </li>
 <li> Sphere center = minimumPt + ( (maximumPt - minimumPt) * 0.5) </li>
 
  <li> I run the above method recursively on the model scenegraph to return a hierarchy of bounding spheres </li>
  <li> The resulting bounding spheres are a good approximation and a tight-enough fit for the underlying model </li>
  </ul>
</p>
<a href="#Top"> Top </a>
<hr>

<p>
<a name="Architecture" class="question">
So what does the architecture look like ?
 </a> 
 <br><br>
 <img src= "http://yuml.me/diagram/scruffy/class/[TeamMgr]++-[Team],[Team]++-[Players]" >
  <br><br>
  <img src=
"http://yuml.me/diagram/scruffy/class/ [Team|TeamColor;Master;NumPlayers; PlayerList|AddPlayer(Player*)]">
<br><br>
 <img src="http://yuml.me/diagram/scruffy/class/[Player]^[Human], [Player]^[Bot]">
<br><br>


 Please see the attached code for more details.
</p>

 </td>
				</tr>
				
	
	</table>
	</td>
	</tr>
-->
 <tr>
      <td class="bodytext" align="center">

      <iframe name="content" src="..\bottombar.html" border="0" width="800" height="50" frameborder="0" scrolling="no" align="center">
                Your browser does not support inline frames. Oops!
      </iframe>
      </td>
  </tr>


</table>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=5744193; 
var sc_invisible=0; 
var sc_security="6e56ab81"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="create counter"
href="http://statcounter.com/free-hit-counter/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/5744193/0/6e56ab81/0/" alt="create
counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

</body>

</html>
